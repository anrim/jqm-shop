(function(a,b){a.widget("mobile.datebox",a.mobile.widget,{options:{theme:"c",pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",pickPageHighButtonTheme:"e",pickPageOHighButtonTheme:"e",pickPageODHighButtonTheme:"e",pickPageTodayButtonTheme:"e",pickPageSlideButtonTheme:"d",pickPageFlipButtonTheme:"b",centerWindow:false,calHighToday:true,calHighPicked:true,noAnimation:false,disabled:false,wheelExists:false,swipeEnabled:true,zindex:"500",debug:false,setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",titleDialogLabel:false,meridiemLetters:["AM","PM"],daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsOfYearShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],timeFormat:24,timeFormats:{"12":"GG:ii AA","24":"HH:ii"},timeOutput:false,mode:"datebox",calShowDays:true,calShowOnlyMonth:false,useDialogForceTrue:false,useDialogForceFalse:false,useDialog:false,useModal:false,useInline:false,noButtonFocusMode:false,noButton:false,noSetButton:false,closeCallback:false,open:false,fieldsOrder:false,dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],durationOrder:["d","h","i","s"],headerFormat:"ddd, mmm dd, YYYY",dateFormat:"YYYY-MM-DD",minuteStep:1,calTodayButton:false,calWeekMode:false,calWeekModeFirstDay:1,calWeekModeHighlight:true,calStartDay:0,defaultDate:false,minYear:false,maxYear:false,afterToday:false,beforeToday:false,maxDays:false,minDays:false,highDays:false,highDates:false,blackDays:false,blackDates:false,durationNoDays:false,durationShort:true,durationSteppers:{d:1,h:1,i:1,s:1},disabledDayColor:"#888"},_dateboxHandler:function(c,d){if(!c.isPropagationStopped()){switch(d.method){case"close":a(this).data("datebox").close();break;case"open":a(this).data("datebox").open();break;case"set":a(this).val(d.value);a(this).trigger("change");break;case"doset":if(a(this).data("datebox").options.mode==="timebox"||a(this).data("datebox").options.mode==="durationbox"){a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatTime(a(this).data("datebox").theDate)})}else{a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatDate(a(this).data("datebox").theDate)})}case"dooffset":a(this).data("datebox")._offset(d.type,d.amount,true);break;case"dorefresh":a(this).data("datebox")._update();break}}},_zeroPad:function(c){return((c<10)?"0":"")+String(c)},_makeOrd:function(d){var c=d%10;if(d>9&&d<21){return"th"}if(c>3){return"th"}return["th","st","nd","rd"][c]},_isInt:function(c){return(c.toString().search(/^[0-9]+$/)===0)},_dstAdjust:function(c){if(!c){return null}c.setHours(c.getHours()>12?c.getHours()+2:0);return c},_getFirstDay:function(c){return new Date(c.getFullYear(),c.getMonth(),1).getDay()},_getLastDate:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth(),32)).getDate()},_getLastDateBefore:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth()-1,32)).getDate()},_formatter:function(d,c){d=d.replace("SS",this._makeOrd(c.getDate()));d=d.replace("YYYY",c.getFullYear());d=d.replace("mmm",this.options.monthsOfYear[c.getMonth()]);d=d.replace("MM",this._zeroPad(c.getMonth()+1));d=d.replace("mm",c.getMonth()+1);d=d.replace("ddd",this.options.daysOfWeek[c.getDay()]);d=d.replace("DD",this._zeroPad(c.getDate()));d=d.replace("dd",c.getDate());d=d.replace("HH",this._zeroPad(c.getHours()));d=d.replace("GG",this._zeroPad(((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():c.getHours()-12))));d=d.replace("hh",((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():(c.getHours()-12))));d=d.replace("gg",c.getHours());d=d.replace("ii",this._zeroPad(c.getMinutes()));d=d.replace("ss",this._zeroPad(c.getSeconds()));d=d.replace("AA",((c.getHours()<12)?this.options.meridiemLetters[0].toUpperCase():this.options.meridiemLetters[1].toUpperCase()));d=d.replace("aa",((c.getHours()<12)?this.options.meridiemLetters[0].toLowerCase():this.options.meridiemLetters[1].toLowerCase()));return d},_formatHeader:function(c){return this._formatter(this.options.headerFormat,c)},_formatDate:function(c){return this._formatter(this.options.dateFormat,c)},_isoDate:function(f,c,e){return String(f)+"-"+((c<10)?"0":"")+String(c)+"-"+((e<10)?"0":"")+String(e)},_formatTime:function(d){var c=this,f,e,j,g="";if(this.options.mode==="durationbox"){e=((c.theDate.getTime()-c.theDate.getMilliseconds())/1000)-((c.initDate.getTime()-c.initDate.getMilliseconds())/1000);j=parseInt(e/(60*60*24),10);if(!c.options.durationNoDays){g=(j===0)?"":String(j)+" "+((j>1)?this.options.durationDays[1]:this.options.durationDays[0])+", ";e=e-(j*60*60*24)}f=parseInt(e/(60*60),10);e=e-(f*60*60);j=parseInt(e/(60),10);e=e-(j*60);if(c.options.durationShort){return g+((f>0||g!=="")?c._zeroPad(f)+":":"")+((j>0||f>0||g!=="")?c._zeroPad(j)+":":"")+((j>0||f>0||g!=="")?c._zeroPad(parseInt(e,10)):String(e))}else{return g+c._zeroPad(f)+":"+c._zeroPad(j)+":"+c._zeroPad(parseInt(e,10))}}else{return this._formatter(c.options.timeOutput,d)}},_makeDate:function(j){j=a.trim(j);var d=this.options,p=this,e=null,l=null,k=null,c=null,f=new Date(),n=0,m=/^(?:([0-9]+) .+, )?(?:([0-9]+):)?(?:([0-9]+):)?([0-9]+)$/i,h=null,g;if(d.mode==="durationbox"){h=m.exec(j);if(h===null){if(typeof d.defaultDate==="number"&&d.defaultDate>0){return new Date(p.initDate.getTime()+(parseInt(d.defaultDate,10)*1000))}else{return new Date(p.initDate.getTime())}}else{n=((p.initDate.getTime()-p.initDate.getMilliseconds())/1000)+parseInt(h[4],10);if(typeof h[3]!=="undefined"){n=n+(parseInt(h[3],10)*60)}if(typeof h[2]!=="undefined"){if(typeof h[3]==="undefined"){n=n+(parseInt(h[2],10)*60)}else{n=n+(parseInt(h[2],10)*60*60)}}if(typeof h[1]!=="undefined"){n=n+(parseInt(h[1],10)*60*60*24)}n=n*1000;return new Date(n)}}else{if(d.mode==="timebox"||d.mode==="timeflipbox"){e=d.timeOutput}else{e=d.dateFormat}e=e.replace(/ddd|SS/g,".+?");e=e.replace(/mmm/g,"(.+?)");e=e.replace(/ *AA/g," *(.*?)");e=e.replace(/yyyy|dd|mm|gg|hh|ii/ig,"([0-9yYdDmMgGhHi]+)");e=e.replace(/ss/g,"([0-9s]+)");e=RegExp("^"+e+"$");l=e.exec(j);if(d.mode==="timebox"||d.mode==="timeflipbox"){k=e.exec(d.timeOutput)}else{k=e.exec(d.dateFormat)}if(d.debug){console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:j,regex:e,input:l,format:k})}if(l===null||l.length!==k.length){if(d.defaultDate!==false){if(a.isArray(d.defaultDate)&&d.defaultDate.length===3){return new Date(d.defaultDate[0],d.defaultDate[1],d.defaultDate[2],0,0,0,0)}else{c=d.defaultDate.split("-");if(c.length===3){f=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),0,0,0,0);if(isNaN(f.getDate())){f=new Date()}}}}}else{for(g=0;g<l.length;g++){if(k[g].match(/^gg$/i)){f.setHours(parseInt(l[g],10))}if(k[g].match(/^hh$/i)){f.setHours(parseInt(l[g],10))}if(k[g].match(/^ii$/i)){f.setMinutes(parseInt(l[g],10))}if(k[g].match(/^ss$/)){f.setSeconds(parseInt(l[g],10))}if(k[g].match(/^dd$/i)){f.setDate(parseInt(l[g],10))}if(k[g].match(/^mm$/i)){f.setMonth(parseInt(l[g],10)-1)}if(k[g].match(/^yyyy$/i)){f.setYear(parseInt(l[g],10))}if(k[g].match(/^AA$/i)){if(l[g].toLowerCase().charAt(0)==="a"&&f.getHours()===12){f.setHours(0)}else{if(l[g].toLowerCase().charAt(0)==="p"&&f.getHours()!==12){f.setHours(f.getHours()+12)}}}if(k[g].match(/^mmm$/i)){c=a.inArray(l[g],d.monthsOfYear);if(c>-1){f.setMonth(c)}}}}if(k[0].match(/G|g|i|s|H|h|A/)){return f}else{return new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0)}}},_checker:function(c){return parseInt(String(c.getFullYear())+this._zeroPad(c.getMonth()+1)+this._zeroPad(c.getDate()),10)},_hoover:function(c){a(c).toggleClass("ui-btn-up-"+a(c).attr("data-theme")+" ui-btn-down-"+a(c).attr("data-theme"))},_offset:function(f,d,g){var c=this,e=this.options;if(typeof(g)==="undefined"){g=true}c.input.trigger("datebox",{method:"offset",type:f,amount:d});switch(f){case"y":c.theDate.setYear(c.theDate.getFullYear()+d);break;case"m":c.theDate.setMonth(c.theDate.getMonth()+d);break;case"d":c.theDate.setDate(c.theDate.getDate()+d);break;case"h":c.theDate.setHours(c.theDate.getHours()+d);break;case"i":c.theDate.setMinutes(c.theDate.getMinutes()+d);break;case"s":c.theDate.setSeconds(c.theDate.getSeconds()+d);break;case"a":if(c.pickerMeri.val()===e.meridiemLetters[0]){c._offset("h",12,false)}else{c._offset("h",-12,false)}break}if(g===true){c._update()}},_updateduration:function(){var c=this,d=(c.initDate.getTime()-c.initDate.getMilliseconds())/1000;if(!c._isInt(c.pickerDay.val())){c.pickerDay.val(0)}if(!c._isInt(c.pickerHour.val())){c.pickerHour.val(0)}if(!c._isInt(c.pickerMins.val())){c.pickerMins.val(0)}if(!c._isInt(c.pickerSecs.val())){c.pickerSecs.val(0)}d=d+(parseInt(c.pickerDay.val(),10)*60*60*24);d=d+(parseInt(c.pickerHour.val(),10)*60*60);d=d+(parseInt(c.pickerMins.val(),10)*60);d=d+(parseInt(c.pickerSecs.val(),10));c.theDate.setTime(d*1000);c._update()},_update:function(){var s=this,e=s.options,p=null,g,h,j,q,n,m,k,f,r,c,d={d:60*60*24,h:60*60,i:60,s:1},l={};s.input.trigger("datebox",{method:"refresh"});if(e.mode==="durationbox"){g=((s.theDate.getTime()-s.theDate.getMilliseconds())/1000)-((s.initDate.getTime()-s.initDate.getMilliseconds())/1000);if(g<0){g=0;s.theDate.setTime(s.initDate.getTime())}m=parseInt(g/d.d,10);g=g-(m*d.d);s.pickerDay.val(m);m=parseInt(g/d.h,10);g=g-(m*d.h);s.pickerHour.val(m);m=parseInt(g/d.i,10);g=g-(m*d.i);s.pickerMins.val(m);s.pickerSecs.val(parseInt(g,10))}if(e.mode==="timebox"){if(e.minuteStep!==1){g=s.theDate.getMinutes()%e.minuteStep;if(g!==0){s.theDate.setMinutes(s.theDate.getMinutes()-g)}}s.pickerMins.val(s._zeroPad(s.theDate.getMinutes()));if(e.timeFormat===12){if(s.theDate.getHours()>11){s.pickerMeri.val(e.meridiemLetters[1]);if(s.theDate.getHours()===12){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours()-12)}}else{s.pickerMeri.val(e.meridiemLetters[0]);if(s.theDate.getHours()===0){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours())}}}else{s.pickerHour.val(s.theDate.getHours())}}if(e.mode==="flipbox"||e.mode==="timeflipbox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));for(m=0;m<e.fieldsOrder.length;m++){c=true;switch(e.fieldsOrder[m]){case"y":n=s.pickerYar.find("ul");n.html("");for(g=-15;g<16;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -453px":"")}).html("<span>"+(s.theDate.getFullYear()+g)+"</span>").attr("data-offset",g).attr("data-theme",k).appendTo(n);if(c===true){c=false}}break;case"m":n=s.pickerMon.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+e.monthsOfYearShort[p.getMonth()]+"</span>").appendTo(n);if(c===true){c=false}}break;case"d":n=s.pickerDay.find("ul");n.html("");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -453px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+p.getDate()+"</span>").appendTo(n);if(c===true){c=false}}break;case"h":n=s.pickerHour.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+((e.timeFormat===12)?((p.getHours()===0)?"12":((p.getHours()<12)?p.getHours():((p.getHours()===12)?"12":(p.getHours()-12)))):p.getHours())+"</span>").appendTo(n);if(c===true){c=false}}break;case"i":n=s.pickerMins.find("ul");n.html("");for(g=-30;g<31;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -933px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+s._zeroPad(p.getMinutes())+"</span>").appendTo(n);if(c===true){c=false}}break;case"a":n=s.pickerMeri.find("ul");n.html("");if(s.theDate.getHours()>11){c="-65";k=[e.pickPageFlipButtonTheme,e.pickPageButtonTheme]}else{c="-33";k=[e.pickPageButtonTheme,e.pickPageFlipButtonTheme]}a("<li>").appendTo(n).clone().appendTo(n);a("<li>",{"class":"ui-body-"+k[0],style:"margin-top: "+c+"px"}).attr("data-offset",1).attr("data-theme",k[0]).html("<span>"+e.meridiemLetters[0]+"</span>").appendTo(n);a("<li>",{"class":"ui-body-"+k[1]}).attr("data-offset",1).attr("data-theme",k[1]).html("<span>"+e.meridiemLetters[1]+"</span>").appendTo(n);a("<li>").appendTo(n).clone().appendTo(n);break}}}if(e.mode==="slidebox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));s.controlsInput.html("");for(m=0;m<e.fieldsOrder.length;m++){r=a("<div>",{"data-rowtype":e.fieldsOrder[m]});if(e.wheelExists){r.bind("mousewheel",function(i,o){i.preventDefault();s._offset(a(this).attr("data-rowtype"),((o>0)?1:-1))})}n=a("<div>",{"class":"ui-datebox-sliderow-int","data-rowtype":e.fieldsOrder[m]}).appendTo(r);if(e.swipeEnabled){n.bind(s.START_DRAG,function(i){if(!s.dragMove){s.dragMove=true;s.dragTarget=a(this);s.dragPos=parseInt(s.dragTarget.css("marginLeft").replace(/px/i,""),10);s.dragStart=s.touch?i.originalEvent.changedTouches[0].pageX:i.pageX;s.dragEnd=false;i.stopPropagation();i.preventDefault()}})}switch(e.fieldsOrder[m]){case"y":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-333px");for(g=-5;g<6;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideyear ui-corner-all ui-btn-up-"+k}).text(s.theDate.getFullYear()+g).attr("data-offset",g).attr("data-theme",k).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("y",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"m":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-204px");for(g=-6;g<7;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slidemonth ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).text(e.monthsOfYearShort[p.getMonth()]).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("m",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"d":r.addClass("ui-datebox-sliderow-d");n.css("marginLeft","-386px");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideday ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(p.getDate()+'<br /><span class="ui-datebox-slidewday">'+e.daysOfWeekShort[p.getDay()]+"</span>").bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("d",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"h":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-284px");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidehour ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(((e.timeFormat===12)?((p.getHours()===0)?'12<span class="ui-datebox-slidewday">AM</span>':((p.getHours()<12)?p.getHours()+'<span class="ui-datebox-slidewday">AM</span>':((p.getHours()===12)?'12<span class="ui-datebox-slidewday">PM</span>':(p.getHours()-12)+'<span class="ui-datebox-slidewday">PM</span>'))):p.getHours())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("h",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"i":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-896px");for(g=-30;g<31;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidemins ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).text(s._zeroPad(p.getMinutes())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("i",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break}r.appendTo(s.controlsInput)}}if(e.mode==="datebox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.beforeToday!==false){p=new Date();if(s.theDate>p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}s.controlsHeader.html(s._formatHeader(s.theDate));s.pickerMon.val(s.theDate.getMonth()+1);s.pickerDay.val(s.theDate.getDate());s.pickerYar.val(s.theDate.getFullYear())}if(e.mode==="calbox"){s.controlsInput.text(e.monthsOfYear[s.theDate.getMonth()]+" "+s.theDate.getFullYear());s.controlsSet.html("");l={today:-1,highlightDay:-1,presetDay:-1,nexttoday:1,thisDate:new Date(),maxDate:new Date(),minDate:new Date(),currentMonth:false,weekMode:0,weekDays:null,thisTheme:e.pickPageButtoTheme};l.start=s._getFirstDay(s.theDate);l.end=s._getLastDate(s.theDate);l.lastend=s._getLastDateBefore(s.theDate);l.presetDate=s._makeDate(s.input.val());if(e.calStartDay>0){l.start=l.start-e.calStartDay;if(l.start<0){l.start=l.start+7}}l.prevtoday=l.lastend-(l.start-1);l.checkDates=(e.afterToday!==false||e.beforeToday!==false||e.notToday!==false||e.maxDays!==false||e.minDays!==false||e.blackDates!==false||e.blackDays!==false);if(l.thisDate.getMonth()===s.theDate.getMonth()&&l.thisDate.getFullYear()===s.theDate.getFullYear()){l.currentMonth=true;l.highlightDay=l.thisDate.getDate()}if(s._checker(l.presetDate)===s._checker(s.theDate)){l.presetDay=l.presetDate.getDate()}s.calNoPrev=false;s.calNoNext=false;if(e.afterToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()>=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoPrev=true}if(e.beforeToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()<=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoNext=true}if(e.minDays!==false){l.minDate.setDate(l.minDate.getDate()-e.minDays);if(s.theDate.getFullYear()===l.minDate.getFullYear()&&s.theDate.getMonth()<=l.minDate.getMonth()){s.calNoPrev=true}}if(e.maxDays!==false){l.maxDate.setDate(l.maxDate.getDate()+e.maxDays);if(s.theDate.getFullYear()===l.maxDate.getFullYear()&&s.theDate.getMonth()>=l.maxDate.getMonth()){s.calNoNext=true}}if(e.calShowDays){if(e.daysOfWeekShort.length<8){e.daysOfWeekShort=e.daysOfWeekShort.concat(e.daysOfWeekShort)}l.weekDays=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);for(g=0;g<=6;g++){a("<div>"+e.daysOfWeekShort[g+e.calStartDay]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(l.weekDays)}}for(h=0;h<=5;h++){if(h===0||(h>0&&(l.today>0&&l.today<=l.end))){n=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);for(j=0;j<=6;j++){if(j===0){l.weekMode=(l.today<1)?(l.prevtoday-l.lastend+e.calWeekModeFirstDay):(l.today+e.calWeekModeFirstDay)}if(j===l.start&&h===0){l.today=1}if(l.today>l.end){l.today=-1}if(l.today<1){if(e.calShowOnlyMonth){a("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(n)}else{if((e.blackDays!==false&&a.inArray(j,e.blackDays)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()),l.prevtoday),e.blackDates)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()+2),l.nexttoday),e.blackDates)>-1)){q=true}else{q=false}if(h===0){a("<div>"+String(l.prevtoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?(l.weekMode+l.lastend):l.prevtoday)).bind((!q)?"vclick":"error",function(i){i.preventDefault();if(!s.calNoPrev){s.theDate.setMonth(s.theDate.getMonth()-1);s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}});l.prevtoday++}else{a("<div>"+String(l.nexttoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?l.weekMode:l.nexttoday)).bind((!q)?"vclick":"error",function(i){i.preventDefault();if(!s.calNoNext){s.theDate.setDate(a(this).attr("data-date"));if(!e.calWeekMode){s.theDate.setMonth(s.theDate.getMonth()+1)}s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}});l.nexttoday++}}}else{q=false;if(l.checkDates){if(e.afterToday&&s._checker(l.thisDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.beforeToday&&s._checker(l.thisDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.notToday&&l.today===l.highlightDay){q=true}if(!q&&e.maxDays!==false&&s._checker(l.maxDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.minDays!==false&&s._checker(l.minDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&(e.blackDays!==false||e.blackDates!==false)){if((a.inArray(j,e.blackDays)>-1)||(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.blackDates)>-1)){q=true}}}if(e.calHighPicked&&l.today===l.presetDay){l.thisTheme=e.pickPageHighButtonTheme}else{if(e.calHighToday&&l.today===l.highlightDay){l.thisTheme=e.pickPageTodayButtonTheme}else{if(a.isArray(e.highDates)&&(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.highDates)>-1)){l.thisTheme=e.pickPageOHighButtonTheme}else{if(a.isArray(e.highDays)&&a.inArray(j,e.highDays)>-1){l.thisTheme=e.pickPageODHighButtonTheme}else{l.thisTheme=e.pickPageButtonTheme}}}}a("<div>"+String(l.today)+"</div>").addClass("ui-datebox-griddate ui-corner-all").attr("data-date",((e.calWeekMode)?l.weekMode:l.today)).attr("data-theme",l.thisTheme).appendTo(n).addClass("ui-btn-up-"+l.thisTheme).bind("vmouseover vmouseout",function(){if(e.calWeekMode!==false&&e.calWeekModeHighlight===true){a(this).parent().find("div").each(function(){s._hoover(this)})}else{s._hoover(this)}}).bind((!q)?"vclick":"error",function(i){i.preventDefault();s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}).css((q)?"color":"nocolor",e.disabledDayColor);l.today++}}}}}},_create:function(){var h=this,i=a.extend(this.options,this.element.data("options")),f=this.element,x=f.wrap('<div class="ui-input-datebox ui-shadow-inset ui-corner-all ui-body-'+i.theme+'"></div>').parent(),l=new Date(),t=new Date(l.getTime()),g=((i.titleDialogLabel===false)?((i.mode==="timebox")?i.titleTimeDialogLabel:i.titleDateDialogLabel):i.titleDialogLabel),k=a('<a href="#" class="ui-input-clear" title="date picker">date picker</a>').bind("vclick",function(o){o.preventDefault();if(!i.disabled){h.input.trigger("datebox",{method:"open"})}setTimeout(function(){a(o.target).closest("a").removeClass(a.mobile.activeBtnClass)},300)}).appendTo(x).buttonMarkup({icon:"grid",iconpos:"notext",corners:true,shadow:true}).css({"vertical-align":"middle","float":"right"}),c=f.closest(".ui-page"),p=a("<div data-role='dialog' class='ui-dialog-datebox' data-theme='"+i.pickPageTheme+"' ><div data-role='header' data-backbtn='false' data-theme='a'><div class='ui-title'>"+g+"</div></div><div data-role='content'></div></div>").appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",i.zindex).addClass("pop"),d=p.find(".ui-content"),e=("ontouchstart" in window),n=e?"touchstart":"mousedown",r=e?"touchmove":"mousemove",j=e?"touchend":"mouseup",u=false,s=false,m=false,q=false,v=false,w=0;a("label[for="+f.attr("id")+"]").addClass("ui-input-text").css("verticalAlign","middle");if(i.mode==="timeflipbox"){i.headerFormat=" "}if(i.timeOutput===false){i.timeOutput=i.timeFormats[i.timeFormat]}if(i.fieldsOrder===false){switch(i.mode){case"timebox":case"timeflipbox":i.fieldsOrder=i.timeFieldOrder;break;case"slidebox":i.fieldsOrder=i.slideFieldOrder;break;default:i.fieldsOrder=i.dateFieldOrder}}if(i.noButtonFocusMode||i.useInline||i.noButton){k.hide()}x.bind("vclick",function(){if(!i.disabled&&i.noButtonFocusMode){f.trigger("datebox",{method:"open"})}});f.removeClass("ui-corner-all ui-shadow-inset").focus(function(){if(!i.disabled){x.addClass("ui-focus");if(i.noButtonFocusMode){x.addClass("ui-focus");f.trigger("datebox",{method:"open"})}}f.removeClass("ui-focus")}).blur(function(){x.removeClass("ui-focus");f.removeClass("ui-focus")}).change(function(){h.theDate=h._makeDate(h.input.val());h._update()});f.bind("datebox",h._dateboxHandler);p.find(".ui-header a").bind("vclick",function(o){o.preventDefault();o.stopImmediatePropagation();h.input.trigger("datebox",{method:"close"})});a.extend(h,{pickPage:p,thisPage:c,pickPageContent:d,input:f,theDate:l,initDate:t,focusedEl:x,touch:e,START_DRAG:n,MOVE_DRAG:r,END_DRAG:j,dragMove:u,dragStart:s,dragEnd:m,dragPos:q});if(typeof a.event.special.mousewheel!=="undefined"){i.wheelExists=true}h._buildPage();if(i.swipeEnabled){a(document).bind(h.MOVE_DRAG,function(o){if(h.dragMove){if(i.mode==="slidebox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageX:o.pageX;h.dragTarget.css("marginLeft",(h.dragPos+h.dragEnd-h.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(i.mode==="flipbox"||i.mode==="timeflipbox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;h.dragTarget.css("marginTop",(h.dragPos+h.dragEnd-h.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(i.mode==="durationbox"||i.mode==="timebox"||i.mode==="datebox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;if((h.dragEnd-h.dragStart)%2===0){w=(h.dragEnd-h.dragStart)/-2;if(w<h.dragPos){h._offset(h.dragTarget,-1*(h.dragTarget==="i"?i.minuteStep:1))}else{if(w>h.dragPos){h._offset(h.dragTarget,1*(h.dragTarget==="i"?i.minuteStep:1))}}h.dragPos=w}o.preventDefault();o.stopPropagation();return false}}}}});a(document).bind(h.END_DRAG,function(o){if(h.dragMove){h.dragMove=false;if(i.mode==="slidebox"){if(h.dragEnd!==false&&Math.abs(h.dragStart-h.dragEnd)>25){o.preventDefault();o.stopPropagation();switch(h.dragTarget.parent().data("rowtype")){case"y":h._offset("y",parseInt((h.dragStart-h.dragEnd)/84,10));break;case"m":h._offset("m",parseInt((h.dragStart-h.dragEnd)/51,10));break;case"d":h._offset("d",parseInt((h.dragStart-h.dragEnd)/32,10));break;case"h":h._offset("h",parseInt((h.dragStart-h.dragEnd)/32,10));break;case"i":h._offset("i",parseInt((h.dragStart-h.dragEnd)/32,10));break}}}else{if(i.mode==="flipbox"||i.mode==="timeflipbox"){if(h.dragEnd!==false){o.preventDefault();o.stopPropagation();h._offset(h.dragTarget.parent().parent().data("field"),parseInt((h.dragStart-h.dragEnd)/30,10))}}}h.dragStart=false;h.dragEnd=false}})}if(f.is(":disabled")){h.disable()}},_buildPage:function(){var n=this,q=n.options,k,t,u=a("<div><a href='#'></a></div>"),e=a("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden pop ui-body-"+q.pickPageTheme}).css("zIndex",q.zindex),v=a("<input type='text' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-datebox-input ui-body-"+q.pickPageInputTheme),j=a("<div>",{"class":"ui-datebox-controls"}),i=a("<div class='ui-overlay-shadow'><ul></ul></div>"),h,A,m,r,s,d,f,l,z,B,p,c,y=false,w=false,g=a("<div>",{"class":"ui-datebox-screen ui-datebox-hidden"+((q.useModal)?" ui-datebox-screen-modal":"")}).css({"z-index":q.zindex-1}).appendTo(n.thisPage).bind("vclick",function(o){o.preventDefault();n.input.trigger("datebox",{method:"close"})});if(q.noAnimation){e.removeClass("pop")}if(q.mode==="flipbox"||q.mode==="timeflipbox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(e).find("h4");A=a("<div>",{"class":"ui-datebox-flipcontent"}).appendTo(e);h=a("<div>",{"class":"ui-datebox-flipcenter ui-overlay-shadow"}).appendTo(e);r=j.clone().appendTo(e);B=i.clone().attr("data-field","d");z=i.clone().attr("data-field","m");p=i.clone().attr("data-field","y");d=i.clone().attr("data-field","h");f=i.clone().attr("data-field","i");l=i.clone().attr("data-field","a");if(q.wheelExists){p.bind("mousewheel",function(o,x){o.preventDefault();n._offset("y",(x<0)?-1:1)});z.bind("mousewheel",function(o,x){o.preventDefault();n._offset("m",(x<0)?-1:1)});B.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",(x<0)?-1:1)});f.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.minuteStep)});l.bind("mousewheel",function(o,x){o.preventDefault();n._offset("a",x)});h.bind("mousewheel",function(o,x){o.preventDefault();if(q.fieldsOrder.length===3){n._offset(q.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/87,10)],((x<0)?-1:1))}else{if(q.fieldsOrder.length===2){n._offset(q.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/130,10)],((x<0)?-1:1))}}})}for(k=0;k<=q.fieldsOrder.length;k++){if(q.fieldsOrder[k]==="y"){p.appendTo(A)}if(q.fieldsOrder[k]==="m"){z.appendTo(A)}if(q.fieldsOrder[k]==="d"){B.appendTo(A)}if(q.fieldsOrder[k]==="h"){d.appendTo(A)}if(q.fieldsOrder[k]==="i"){f.appendTo(A)}if(q.fieldsOrder[k]==="a"&&q.timeFormat===12){l.appendTo(A)}}if(q.swipeEnabled){A.find("ul").bind(n.START_DRAG,function(x,o){if(!n.dragMove){if(typeof o!=="undefined"){x=o}n.dragMove=true;n.dragTarget=a(this).find("li").first();n.dragPos=parseInt(n.dragTarget.css("marginTop").replace(/px/i,""),10);n.dragStart=n.touch?x.originalEvent.changedTouches[0].pageY:x.pageY;n.dragEnd=false;x.stopPropagation();x.preventDefault()}});h.bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragTarget=n.touch?o.originalEvent.changedTouches[0].pageX-a(o.currentTarget).offset().left:o.pageX-a(o.currentTarget).offset().left;if(q.fieldsOrder.length===3){a(n.controlsInput.find("ul").get(parseInt(n.dragTarget/87,10))).trigger(n.START_DRAG,o)}else{if(q.fieldsOrder.length===2){a(n.controlsInput.find("ul").get(parseInt(n.dragTarget/130,10))).trigger(n.START_DRAG,o)}}}})}if(q.noSetButton===false){a("<a href='#'>"+((q.mode==="timeflipbox")?q.setTimeButtonLabel:q.setDateButtonLabel)+"</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(q.mode==="timeflipbox"){n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate)})}else{n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate)})}n.input.trigger("datebox",{method:"close"})})}a.extend(n,{controlsHeader:s,controlsInput:A,pickerDay:B,pickerMon:z,pickerYar:p,pickerHour:d,pickerMins:f,pickerMeri:l});e.appendTo(n.thisPage)}if(q.mode==="durationbox"){h=j.clone().removeClass("ui-datebox-controls").addClass("ui-datebox-scontrols").appendTo(e);A=h.clone().appendTo(e);m=h.clone().appendTo(e);r=j.clone().appendTo(e);B=v.removeClass("ui-datebox-input").clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});d=B.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});f=B.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});c=B.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});if(q.wheelExists){B.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",((x<0)?-1:1)*q.durationSteppers.d)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",((x<0)?-1:1)*q.durationSteppers.h)});f.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.durationSteppers.i)});c.bind("mousewheel",function(o,x){o.preventDefault();n._offset("s",((x<0)?-1:1)*q.durationSteppers.s)})}for(k=0;k<q.durationOrder.length;k++){switch(q.durationOrder[k]){case"d":a("<div>",{"class":"ui-datebox-sinput","data-field":"d"}).append(B).appendTo(A).prepend("<label>"+q.durationLabel[0]+"</label>");break;case"h":a("<div>",{"class":"ui-datebox-sinput","data-field":"h"}).append(d).appendTo(A).prepend("<label>"+q.durationLabel[1]+"</label>");break;case"i":a("<div>",{"class":"ui-datebox-sinput","data-field":"i"}).append(f).appendTo(A).prepend("<label>"+q.durationLabel[2]+"</label>");break;case"s":a("<div>",{"class":"ui-datebox-sinput","data-field":"s"}).append(c).appendTo(A).prepend("<label>"+q.durationLabel[3]+"</label>");break}}if(q.swipeEnabled){A.find("input").bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragMove=true;n.dragTarget=a(this).parent().data("field");n.dragPos=0;n.dragStart=n.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;n.dragEnd=false;o.stopPropagation()}})}if(q.noSetButton===false){a("<a href='#'>"+q.setDurationButtonLabel+"</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate)});n.input.trigger("datebox",{method:"close"})})}for(k=0;k<q.durationOrder.length;k++){u.clone().appendTo(h).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",q.durationOrder[k]).bind("vclick",function(o){o.preventDefault();n._offset(a(this).attr("data-field"),q.durationSteppers[a(this).attr("data-field")])});u.clone().appendTo(m).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",q.durationOrder[k]).bind("vclick",function(o){o.preventDefault();n._offset(a(this).attr("data-field"),-1*q.durationSteppers[a(this).attr("data-field")])})}a.extend(n,{pickerHour:d,pickerMins:f,pickerDay:B,pickerSecs:c});e.appendTo(n.thisPage)}if(q.mode==="datebox"||q.mode==="timebox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(e).find("h4");h=j.clone().appendTo(e);A=j.clone().appendTo(e);m=j.clone().appendTo(e);r=j.clone().appendTo(e);if(q.mode==="timebox"){s.parent().html("")}z=v.clone().attr("data-field","m").keyup(function(){if(a(this).val()!==""&&n._isInt(a(this).val())){n.theDate.setMonth(parseInt(a(this).val(),10)-1);n._update()}});B=z.clone().attr("data-field","d").keyup(function(){if(a(this).val()!==""&&n._isInt(a(this).val())){n.theDate.setDate(parseInt(a(this).val(),10));n._update()}});p=z.clone().attr("data-field","y").keyup(function(){if(a(this).val()!==""&&n._isInt(a(this).val())){n.theDate.setFullYear(parseInt(a(this).val(),10));n._update()}});d=v.clone().attr("data-field","h").keyup(function(){if(a(this).val()!==""&&n._isInt(a(this).val())){t=parseInt(a(this).val(),10);if(t===12){if(q.timeFormat===12&&l.val()===q.meridiemLetters[0]){t=0}}n.theDate.setHours(t);n._update()}});f=v.clone().attr("data-field","i").keyup(function(){if(a(this).val()!==""&&n._isInt(a(this).val())){n.theDate.setMinutes(parseInt(a(this).val(),10));n._update()}});l=v.clone().attr("data-field","a").keyup(function(){if(a(this).val()!==""){n._update()}});if(q.wheelExists){p.bind("mousewheel",function(o,x){o.preventDefault();n._offset("y",(x<0)?-1:1)});z.bind("mousewheel",function(o,x){o.preventDefault();n._offset("m",(x<0)?-1:1)});B.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",(x<0)?-1:1)});f.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.minuteStep)});l.bind("mousewheel",function(o,x){o.preventDefault();n._offset("a",x)})}for(k=0;k<=q.fieldsOrder.length;k++){if(q.fieldsOrder[k]==="y"){p.appendTo(A)}if(q.fieldsOrder[k]==="m"){z.appendTo(A)}if(q.fieldsOrder[k]==="d"){B.appendTo(A)}if(q.fieldsOrder[k]==="h"){d.appendTo(A)}if(q.fieldsOrder[k]==="i"){f.appendTo(A)}if(q.fieldsOrder[k]==="a"&&q.timeFormat===12){l.appendTo(A)}}if(q.swipeEnabled){A.find("input").bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragMove=true;n.dragTarget=a(this).data("field");n.dragPos=0;n.dragStart=n.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;n.dragEnd=false;o.stopPropagation()}})}if(q.noSetButton===false){a("<a href='#'>"+((q.mode==="timebox")?q.setTimeButtonLabel:q.setDateButtonLabel)+"</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(q.mode==="timebox"){n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate)})}else{n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate)})}n.input.trigger("datebox",{method:"close"})})}for(k=0;k<n.options.fieldsOrder.length;k++){if(q.fieldsOrder[k]!=="a"||q.timeFormat===12){u.clone().appendTo(h).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",q.fieldsOrder[k]).bind("vclick",function(o){o.preventDefault();n._offset(a(this).attr("data-field"),1*(a(this).attr("data-field")==="i"?q.minuteStep:1))});u.clone().appendTo(m).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",q.fieldsOrder[k]).bind("vclick",function(o){o.preventDefault();n._offset(a(this).attr("data-field"),-1*(a(this).attr("data-field")==="i"?q.minuteStep:1))})}}a.extend(n,{controlsHeader:s,pickerDay:B,pickerMon:z,pickerYar:p,pickerHour:d,pickerMins:f,pickerMeri:l});e.appendTo(n.thisPage)}if(q.mode==="calbox"){s=a("<div>",{"class":"ui-datebox-gridheader"}).appendTo(e);r=a("<div>",{"class":"ui-datebox-grid"}).appendTo(e);A=a("<div class='ui-datebox-gridlabel'><h4>Uninitialized</h4></div>").appendTo(s).find("h4");if(q.swipeEnabled){e.bind("swipeleft",function(){if(!n.calNoNext){n._offset("m",1)}}).bind("swiperight",function(){if(!n.calNoPrev){n._offset("m",-1)}})}if(q.wheelExists){e.bind("mousewheel",function(o,x){o.preventDefault();if(x>0&&!n.calNoNext){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",1)}if(x<0&&!n.calNoPrev){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",-1)}})}a("<div class='ui-datebox-gridplus'><a href='#'>Next Month</a></div>").prependTo(s).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(!n.calNoNext){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",1)}});a("<div class='ui-datebox-gridminus'><a href='#'>Prev Month</a></div>").prependTo(s).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(!n.calNoPrev){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",-1)}});if(q.calTodayButton===true){a("<a href='#'>"+q.calTodayButtonLabel+"</a>").appendTo(e).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();n.theDate=new Date();n.theDate=new Date(n.theDate.getFullYear(),n.theDate.getMonth(),n.theDate.getDate(),0,0,0,0);n.input.trigger("datebox",{method:"doset"})})}a.extend(n,{controlsInput:A,controlsSet:r,calNoNext:y,calNoPrev:w});e.appendTo(n.thisPage)}if(q.mode==="slidebox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(e).find("h4");A=a("<div>").addClass("ui-datebox-slide").appendTo(e);r=a("<div>",{"class":"ui-datebox-controls"}).appendTo(e);if(q.noSetButton===false){a("<a href='#'>"+q.setDateButtonLabel+"</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate)});n.input.trigger("datebox",{method:"close"})})}a.extend(n,{controlsHeader:s,controlsInput:A});e.appendTo(n.thisPage)}a.extend(n,{pickerContent:e,screen:g});if(q.useInline){n.input.parent().parent().append(n.pickerContent);if(q.useInlineHideInput){n.input.parent().hide()}n.input.trigger("change");n.pickerContent.removeClass("ui-datebox-hidden")}},refresh:function(){if(this.options.useInline===true){this.input.trigger("change")}this._update()},open:function(){if(this.options.useInline){return false}if(this.options.open===true){return false}else{this.options.open=true}this.input.trigger("change").blur();var c=this,i=this.options,e=c.focusedEl.offset(),g=c.pickerContent.outerHeight(),f=c.pickerContent.innerWidth(),h=e.top+(c.focusedEl.outerHeight()/2)-(g/2),d=e.left+(c.focusedEl.outerWidth()/2)-(f/2);if((d+f)>a(document).width()){d=a(document).width()-f-1}if(d<0){d=0}if(i.centerWindow){d=(a(document).width()/2)-(f/2)}if((g+h)>a(document).height()){h=a(document).height()-(g+2)}if(h<45){h=45}if((a(document).width()>400&&!i.useDialogForceTrue)||i.useDialogForceFalse){i.useDialog=false;if(i.useModal){c.screen.fadeIn("slow")}else{c.screen.removeClass("ui-datebox-hidden")}c.pickerContent.addClass("ui-overlay-shadow in").css({position:"absolute",top:h,left:d}).removeClass("ui-datebox-hidden")}else{i.useDialog=true;c.pickPageContent.append(c.pickerContent);c.pickerContent.css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).removeClass("ui-overlay-shadow ui-datebox-hidden");a.mobile.changePage(c.pickPage,{transition:"pop"})}},close:function(){var c=this,d;if(c.options.useInline){return true}c.options.open=false;if(c.options.useDialog){a(c.pickPage).dialog("close");c.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",c.options.zindex);c.thisPage.append(c.pickerContent)}else{if(c.options.useModal){c.screen.fadeOut("slow")}else{c.screen.addClass("ui-datebox-hidden")}c.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",c.options.zindex).removeClass("in")}c.focusedEl.removeClass("ui-focus");if(c.options.closeCallback!==false){d=new Function(c.options.closeCallback);d()}},disable:function(){this.element.attr("disabled",true);this.element.parent().addClass("ui-disabled");this.options.disabled=true;this.element.blur();this.input.trigger("datebox",{method:"disable"})},enable:function(){this.element.attr("disabled",false);this.element.parent().removeClass("ui-disabled");this.options.disabled=false;this.input.trigger("datebox",{method:"enable"})}});a(document).bind("pagebeforecreate",function(c){a(":jqmData(role='datebox')",c.target).each(function(){a(this).replaceWith(a("<div>").html(a(this).clone()).html().replace(/\s+type=["']date['"]?/,' type="text" '))})});a(document).bind("pagecreate",function(c){a(":jqmData(role='datebox')",c.target).datebox()})})(jQuery);